<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Plantilla Proveedor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">

  <style>
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background-color: #f8f9fa; }
    body { display: flex; flex-direction: column; }
    .container.flex-grow-1 { flex: 1; display: flex; flex-direction: column; overflow-y: auto; min-height: 0; padding-bottom: 20px; }
    .card { border: none; border-radius: 10px; overflow: hidden; flex-shrink: 0; }
    table.dataTable thead th { background-color: #343a40; color: white; vertical-align: middle; }
  </style>
</head>
<body>

<div th:replace="~{fragments :: menu('proveedores')}"></div>

<div class="container mt-4 mb-5 flex-grow-1">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-1">
          <li class="breadcrumb-item"><a href="/proveedores">Empresas</a></li>
          <li class="breadcrumb-item active" aria-current="page">Empleados</li>
        </ol>
      </nav>
      <h2 class="text-dark fw-bold mb-0">
        <i class="bi bi-people-fill text-info"></i>
        <span th:text="${proveedor.denominacion}">Nombre Empresa</span>
      </h2>
    </div>
    <a th:href="@{/proveedores/{cif}/empleados/nuevo(cif=${proveedor.cif})}" class="btn btn-dark shadow-sm">
      <i class="bi bi-person-plus-fill"></i> Añadir Trabajador
    </a>
  </div>

  <div class="card shadow">
    <div class="card-body p-4">
      <table id="tablaEmpleados" class="table table-striped table-hover dt-responsive nowrap" style="width:100%">
        <thead class="table-dark">
        <tr>
          <th>DNI/NIF</th>
          <th>Nombre Completo</th>
          <th>Cargo</th>
          <th>Acceso Desde</th>
          <th>Acceso Hasta</th>
          <th>Estado</th>
          <th class="text-center">Acciones</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="emp : ${listaEmpleados}">
          <td th:text="${emp.nif}" class="fw-bold">12345678X</td>
          <td th:text="${emp.nombre} + ' ' + ${emp.apellido1} + ' ' + (${emp.apellido2} ?: '')">Nombre</td>
          <td th:text="${emp.cargo}">Técnico</td>

          <td th:text="${emp.fechaAcceso}">01-01-2025</td>
          <td th:text="${emp.fechaFinAcceso}">31-12-2025</td>

          <td>
                        <span th:if="${emp.fechaFinAcceso == null or emp.fechaFinAcceso.isAfter(#temporals.createToday())}"
                              class="badge bg-success">Vigente</span>
            <span th:if="${emp.fechaFinAcceso != null and !emp.fechaFinAcceso.isAfter(#temporals.createToday())}"
                  class="badge bg-danger">Caducado</span>
          </td>

          <td class="text-center">
            <a th:href="@{/proveedores/empleados/eliminar/{id}(id=${emp.id}, cif=${proveedor.cif})}"
               class="btn btn-danger btn-sm"
               onclick="return confirm('¿Eliminar a este trabajador de la lista autorizada?');">
              <i class="bi bi-trash"></i>
            </a>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>

<script th:inline="none">
  $(document).ready(function() {
    $('#tablaEmpleados').DataTable({
      responsive: true, pageLength: 10,
      language: { url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json' }
    });
  });
</script>

<div th:replace="~{fragments :: bloquearNavegacion}"></div>

</body>
</html>